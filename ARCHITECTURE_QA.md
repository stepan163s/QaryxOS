# QaryxOS ‚Äî Architecture Q&A

---

## üß† –ë–õ–û–ö 1 ‚Äî –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**1. –ù–∞ —á—ë–º —Å–µ–π—á–∞—Å –≤—Å—ë –∫—Ä—É—Ç–∏—Ç—Å—è?**
Armbian/Radxa Debian (Debian-based, headless CLI). Desktop-–æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ—Ç —Å–æ–≤—Å–µ–º.
–¶–µ–ª–µ–≤–æ–π –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Radxa image –¥–ª—è Zero 3W (RK3566), –ø–æ–≤–µ—Ä—Ö –∫–æ—Ç–æ—Ä–æ–≥–æ
`os/scripts/install.sh` –Ω–∞–∫–∞—Ç—ã–≤–∞–µ—Ç overlay-—Ñ–∞–π–ª—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã.

**2. –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è UI?**
–ß–µ—Ä–µ–∑ systemd —Å–µ—Ä–≤–∏—Å `qaryxos-mediashell.service`. –ù–∏–∫–∞–∫–æ–≥–æ `startx`.
Pygame –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –∏–∑ TTY –≤ DRM/KMS-—Ä–µ–∂–∏–º–µ (SDL_VIDEODRIVER=kmsdrm).
–ü–æ—Ä—è–¥–æ–∫ —Å—Ç–∞—Ä—Ç–∞:
```
qaryxos-cpu-governor ‚Üí qaryxos-zram ‚Üí qaryxos-mpv ‚Üí qaryxos-api ‚Üí qaryxos-mediashell
```

**3. –ï—Å—Ç—å –ª–∏ X11 / Wayland –≤ —Å–∏—Å—Ç–µ–º–µ?**
–ù–µ—Ç. –ù–∏–∫–∞–∫–æ–≥–æ X11/Wayland. Pygame/SDL —Ö–æ–¥–∏—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ DRM/KMS —á–µ—Ä–µ–∑ `/dev/dri/card0`
–∏ `/dev/fb0`. –≠—Ç–æ –¥–∞—ë—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead –∏ –±—ã—Å—Ç—Ä—ã–π boot.

**4. –ì–¥–µ –∂–∏–≤—ë—Ç mpv?**
- –û—Ç–¥–µ–ª—å–Ω—ã–π systemd —Å–µ—Ä–≤–∏—Å `qaryxos-mpv.service`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π:
  ```
  /usr/bin/mpv --config-file=/etc/mpv/mpv.conf --idle=yes \
               --input-ipc-server=/tmp/mpv.sock --no-terminal
  ```
- API –æ–±—â–∞–µ—Ç—Å—è —Å –Ω–∏–º —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Unix-—Å–æ–∫–µ—Ç `/tmp/mpv.sock` (JSON IPC)
- Python –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞–µ—Ç `subprocess` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è mpv ‚Äî —Ç–æ–ª—å–∫–æ `asyncio.open_unix_connection`

**5. –í—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –æ–¥–∏–Ω Python –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤?**
–ù–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
| –°–µ—Ä–≤–∏—Å | –ü—Ä–æ—Ü–µ—Å—Å | –ü–æ—Ä—Ç/—Å–æ–∫–µ—Ç |
|---|---|---|
| `qaryxos-mpv` | `/usr/bin/mpv` (C) | `/tmp/mpv.sock` |
| `qaryxos-api` | `uvicorn` (Python/asyncio) | `:8080` |
| `qaryxos-mediashell` | `python3 main.py` (pygame) | ‚Äî (–∫–ª–∏–µ–Ω—Ç API) |
| `qaryxos-cpu-governor` | oneshot | ‚Äî |
| `qaryxos-zram` | oneshot | ‚Äî |

---

## üêç –ë–õ–û–ö 2 ‚Äî Python / Pygame UI

**6. –ö–∞–∫–∞—è –≤–µ—Ä—Å–∏—è Python?**
Python 3.10+ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `str | None`, `list[dict]` –±–µ–∑ `from __future__`,
`asyncio.timeout()`). –¢–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Armbian-–ø–∞–∫–µ—Ç–∞ ‚Äî –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ 3.11 –Ω–∞
Bookworm-based –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞—Ö.

**7. –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–∏ asyncio / threading / multiprocessing?**
- **asyncio**: –≤ `qaryxos-api` (uvicorn + FastAPI) ‚Äî –≤–µ—Å—å API –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
- **threading**: –≤ `qaryxos-mediashell` ‚Äî –æ–¥–∏–Ω —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ `_poll_thread` –¥–ª—è
  –æ–ø—Ä–æ—Å–∞ `/ui/state`; –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ ‚Äî pygame event loop
- **multiprocessing**: –Ω–µ—Ç

**8. –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª?**
```python
# mediashell/main.py
while True:
    events = pygame.event.get()
    for event in events:
        if event.type == pygame.QUIT:
            self._quit()
        elif event.type == pygame.KEYDOWN:
            self._handle_key_event(event.key)

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à, –ø—Ä–∏—à–µ–¥—à–∏—Ö —Å Android —á–µ—Ä–µ–∑ HTTP-–ø–æ–ª–ª–∏–Ω–≥
    while self.key_queue:
        key = self.key_queue.pop(0)
        if key.startswith("navigate:"):
            self.navigate(key.split(":", 1)[1])
        else:
            self._handle_key(key)

    current = self.screens.get(self.current_screen)
    if current:
        self.screen.fill(BG)
        current.draw(self.screen)
        pygame.display.flip()

    self.clock.tick(FPS)   # FPS = 30
```

**9. FPS —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–ª–∏ –Ω–µ—Ç?**
–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ‚Äî 30 FPS —á–µ—Ä–µ–∑ `clock.tick(30)`. –ü—Ä–∏ idle UI —Ç—Ä–∞—Ç–∏—Ç CPU –¥–∞–∂–µ –±–µ–∑
–∞–Ω–∏–º–∞—Ü–∏–π. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 15 FPS –≤ —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö, –Ω–æ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.

**10. –ö–∞–∫ —Ä–µ–Ω–¥–µ—Ä–∏—à—å –ø–ª–∏—Ç–∫–∏?**
–ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º **–≤–µ—Å—å —ç–∫—Ä–∞–Ω –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä** (`surface.fill(BG)` + –ø–æ–ª–Ω—ã–π redraw).
Dirty rectangles –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. –ü—Ä–∏ —Å—Ç–∞—Ç–∏—á–Ω–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ —ç—Ç–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ, –Ω–æ –¥–ª—è
RK3566 —Å DRM/KMS —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ: –Ω–µ—Ç GPU-overdraw, –≤—Å—ë CPU-blitting –≤ framebuffer.

**11. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ hardware acceleration –≤ pygame?**
–ù–µ—Ç. Pygame –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SDL software renderer ‚Üí CPU blitting –≤ `/dev/fb0`.
mpv –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `hwdec=rkmpp` (Rockchip MPP) –∏ `vo=drm` ‚Äî –Ω–æ —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π
–ø—Ä–æ—Ü–µ—Å—Å, pygame —Å mpv –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –ø–æ —Ä–µ–Ω–¥–µ—Ä—É.

**12. –ö–∞–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU –ø—Ä–∏ idle UI?**
–¢–æ—á–Ω—ã—Ö –∑–∞–º–µ—Ä–æ–≤ –Ω–µ—Ç (–Ω–µ –¥–µ–ø–ª–æ–∏–ª–∏), –Ω–æ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ ~5‚Äì15% –Ω–∞ –æ–¥–Ω–æ–º —è–¥—Ä–µ A55
–ø—Ä–∏ 30 FPS software blit 1080p. –ü—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –¥–æ 15 FPS –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ dirty
rectangles –º–æ–∂–Ω–æ –æ–ø—É—Å—Ç–∏—Ç—å –¥–æ <5%.

**13. –ö–∞–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –ø–ª–∏—Ç–æ–∫?**
–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ ~10‚Äì20% ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ `font.render()` –≤—ã–∑–æ–≤—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–∞–¥—Ä–µ.
–®—Ä–∏—Ñ—Ç—ã –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º.

---

## üé¨ –ë–õ–û–ö 3 ‚Äî –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

**14. –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è mpv?**
mpv –∑–∞–ø—É—â–µ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∫–∞–∫ systemd-—Å–µ—Ä–≤–∏—Å –≤ `--idle` —Ä–µ–∂–∏–º–µ:
```bash
/usr/bin/mpv \
    --config-file=/etc/mpv/mpv.conf \
    --idle=yes \
    --input-ipc-server=/tmp/mpv.sock \
    --no-terminal
```
–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ IPC –∫–æ–º–∞–Ω–¥—É `loadfile`:
```python
await self.command("loadfile", url, "replace")
```

**15. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ hwdec / vo=gpu / gpu-context=drm?**
```ini
# /etc/mpv/mpv.conf
hwdec=rkmpp              # Rockchip MPP ‚Äî –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –¥–µ–∫–æ–¥–µ—Ä H.264/HEVC/VP9/AV1
hwdec-codecs=h264,hevc,vp9,av1
vo=drm                   # Direct Rendering Manager, –±–µ–∑ GPU compositor
drm-connector=HDMI-A-1
drm-device=/dev/dri/card0
vd-lavc-dr=yes           # direct rendering: —É–±–∏—Ä–∞–µ—Ç –ª–∏—à–Ω–µ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
```
`vo=gpu` **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** ‚Äî –Ω–∞ RK3566 `vo=drm` –Ω–∞–¥—ë–∂–Ω–µ–µ –∏ —Ç—Ä–µ–±—É–µ—Ç –º–µ–Ω—å—à–µ
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. `gpu-context=drm` –Ω–µ –Ω—É–∂–µ–Ω –ø—Ä–∏ `vo=drm`.

**16. –ï—Å—Ç—å –ª–∏ input-ipc-server?**
–î–∞: `/tmp/mpv.sock`. –í—Å—ë —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (play, pause, seek, volume, stop) –∏–¥—ë—Ç
—á–µ—Ä–µ–∑ —ç—Ç–æ—Ç —Å–æ–∫–µ—Ç. API –¥–µ–ª–∞–µ—Ç `asyncio.open_unix_connection("/tmp/mpv.sock")`.

**17. –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤—ã—Ö–æ–¥ –∏–∑ –≤–∏–¥–µ–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ UI?**
mpv –æ—Å—Ç–∞—ë—Ç—Å—è –≤ `--idle=yes` –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–∏–¥–µ–æ ‚Äî framebuffer –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
mediashell'—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ö–æ–º–∞–Ω–¥–∞ `stop` —á–µ—Ä–µ–∑ IPC –ø–µ—Ä–µ–≤–æ–¥–∏—Ç mpv –æ–±—Ä–∞—Ç–Ω–æ –≤
idle. Mediashell –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–≤–æ–π render loop –≤—Å—ë –≤—Ä–µ–º—è ‚Äî –æ–Ω –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è
mpv –ø–æ–∫–∞ —Ç–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –≤–∏–¥–µ–æ –≤ DRM overlay.

**18. –ï—Å—Ç—å –ª–∏ overlay UI –ø–æ–≤–µ—Ä—Ö mpv?**
–ù–µ—Ç. mpv –∏ mediashell –¥–µ–ª—è—Ç DRM/KMS framebuffer. –ü–æ–∫–∞ mpv –∏–≥—Ä–∞–µ—Ç ‚Äî –æ–Ω –≤–ª–∞–¥–µ–µ—Ç
—ç–∫—Ä–∞–Ω–æ–º —Ü–µ–ª–∏–∫–æ–º. OSD (–≤—Ä–µ–º—è, –≥—Ä–æ–º–∫–æ—Å—Ç—å) —Ä–∏—Å—É–µ—Ç —Å–∞–º mpv —á–µ—Ä–µ–∑ `osd-level=1`.
Overlay UI (–ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏–∑ mediashell –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ) ‚Äî –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.

---

## üì° –ë–õ–û–ö 4 ‚Äî IPTV

**19. –ö–∞–∫ –ø–∞—Ä—Å–∏—à—å M3U?**
–í—Ä—É—á–Ω—É—é, –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `api/services/iptv.py`:
```python
def _parse_m3u(content: str, playlist_id: str) -> list[IptvChannel]:
    # –ø–æ—Å—Ç—Ä–æ—á–Ω—ã–π –ø–∞—Ä—Å–µ—Ä: –∏—â–µ—Ç #EXTINF:, –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã —á–µ—Ä–µ–∑ re.findall
    for key, value in re.findall(r'([\w-]+)="([^"]*)"', attrs_part):
        ...
```
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `tvg-id`, `tvg-logo`, `group-title`, channel name –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.

**20. M3U —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è?**
–ö—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ JSON-—Ñ–∞–π–ª–∞—Ö –Ω–∞ –¥–∏—Å–∫:
- –ü–ª–µ–π–ª–∏—Å—Ç—ã: `/var/lib/qaryxos/playlists.json`
- –ö–∞–Ω–∞–ª—ã –∫–∞–∂–¥–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞: `/var/lib/qaryxos/iptv_cache/{playlist_id}.json`

–í –ø–∞–º—è—Ç–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ—Ä–∂–∏—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ ‚Äî –∫–∞–∂–¥—ã–π GET `/iptv/channels`
—á–∏—Ç–∞–µ—Ç —Å –¥–∏—Å–∫–∞. –î–ª—è –±–æ–ª—å—à–∏—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ (10k+ –∫–∞–Ω–∞–ª–æ–≤) —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ.

**21. –ï—Å—Ç—å –ª–∏ EPG?**
–ù–µ—Ç. EPG –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –≤ v2.0 (issue #28).

**22. –ö–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –∫–∞–Ω–∞–ª—ã?**
–ß–µ—Ä–µ–∑ IPC –∫–æ–º–∞–Ω–¥—É `loadfile` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `replace` ‚Äî mpv –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```python
await mpv.load(channel.url, profile="live")
# ‚Üí set_property("profile", "live")  ‚Üê low-latency –ø—Ä–æ—Ñ–∏–ª—å
# ‚Üí command("loadfile", url, "replace")
```
–ü—Ä–æ—Ñ–∏–ª—å `[live]` –≤ mpv.conf: `cache=no`, `demuxer-max-bytes=8MiB`, reconnect.

**23. –ï—Å—Ç—å –ª–∏ pre-buffering —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–∞–Ω–∞–ª–∞?**
–ù–µ—Ç. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π `loadfile`, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω—É–ª—è.

---

## üåê –ë–õ–û–ö 5 ‚Äî YouTube / –ü–∞—Ä—Å–∏–Ω–≥

**24. –ì–¥–µ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç yt-dlp?**
–ù–∞ –ø–ª–∞—Ç–µ (Radxa Zero 3W). –ë–∏–Ω–∞—Ä–Ω–∏–∫: `/usr/local/bin/yt-dlp` (standalone,
–±–µ–∑ Python-–æ–∫—Ä—É–∂–µ–Ω–∏—è). –¢–µ–ª–µ—Ñ–æ–Ω —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç URL —á–µ—Ä–µ–∑ REST API.

**25. –ó–∞–ø—É—Å–∫–∞–µ—à—å –∫–∞–∫ subprocess?**
–î–∞, —á–µ—Ä–µ–∑ asyncio:
```python
proc = await asyncio.create_subprocess_exec(
    YTDLP_BIN, "--no-warnings", "--no-playlist",
    "-f", format_spec, "--get-url", url,
    stdout=asyncio.subprocess.PIPE,
    stderr=asyncio.subprocess.PIPE,
)
stdout, stderr = await asyncio.wait_for(proc.communicate(), timeout=30)
```

**26. –ö—ç—à–∏—Ä—É—é—Ç—Å—è –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?**
- **–ü—Ä—è–º—ã–µ stream URL**: –¥–∞, in-memory cache 4 —á–∞—Å–∞ (`_URL_CACHE` –≤ ytdlp.py).
  –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç–æ–≥–æ –∂–µ –≤–∏–¥–µ–æ ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ (<50ms).
- **–°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∫–∞–Ω–∞–ª–∞**: –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ JSON –Ω–∞ –¥–∏—Å–∫ (`/var/lib/qaryxos/youtube/{id}.json`).
  –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É —á–µ—Ä–µ–∑ `/youtube/refresh` –∏–ª–∏ systemd timer.
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ**: –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è.

**27. –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–∞?**
- –ü–µ—Ä–≤—ã–π —Ä–∞–∑ (yt-dlp `--flat-playlist`): **15‚Äì45 —Å–µ–∫—É–Ω–¥** –Ω–∞ 10 –≤–∏–¥–µ–æ.
  –ù–∞ RK3566 —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ ‚Äî yt-dlp –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Python runtime,
  –¥–µ–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ YouTube.
- –ü–æ–≤—Ç–æ—Ä–Ω–æ (–∏–∑ JSON –∫—ç—à–∞): **<10ms** (—á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞).

---

## ‚öô –ë–õ–û–ö 6 ‚Äî –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

**28. –°–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ boot –¥–æ UI?**
–¶–µ–ª—å: <12s (issue #3). –¢–µ–∫—É—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –£–±—Ä–∞–Ω `network-online.target` –∏–∑ `qaryxos-api.service` (-10‚Äì30s)
- `qaryxos-cpu-governor.service` ‚Äî –≤—Å–µ —è–¥—Ä–∞ –≤ `performance` –¥–æ —Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- `qaryxos-zram.service` ‚Äî 512MB —Å–∂–∞—Ç–æ–≥–æ swap (zstd)
- systemd `Type=simple` –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
–†–µ–∞–ª—å–Ω—ã–π –∑–∞–º–µ—Ä –Ω–∞ –∂–µ–ª–µ–∑–µ –µ—â—ë –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª—Å—è.

**29. –°–∫–æ–ª—å–∫–æ RAM –∑–∞–Ω—è—Ç–æ –≤ idle?**
–ó–∞–º–µ—Ä—ã `free -h` –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∂–µ–ª–µ–∑–µ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∏—Å—å. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏:
- mpv idle: ~30‚Äì50MB
- uvicorn (1 worker): ~60‚Äì80MB
- mediashell (pygame): ~40‚Äì60MB
- –û–° + avahi + –ø—Ä–æ—á–µ–µ: ~100MB
–ò—Ç–æ–≥–æ: **~230‚Äì290MB** –∏–∑ 2GB ‚Üí –æ—Å—Ç–∞—Ç–æ–∫ ~1.7GB (zram –¥–æ–±–∞–≤–ª—è–µ—Ç –µ—â—ë 512MB –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ)

**30. –ö–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã?**
–ö–∞—Å—Ç–æ–º–Ω—ã–µ QaryxOS:
```
qaryxos-mpv.service          ‚Äî mpv player (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)
qaryxos-api.service          ‚Äî FastAPI/uvicorn REST
qaryxos-mediashell.service   ‚Äî pygame TV UI
qaryxos-cpu-governor.service ‚Äî oneshot, –≤—ã–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
qaryxos-zram.service         ‚Äî oneshot, –≤—ã–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
avahi-daemon.service         ‚Äî mDNS discovery –¥–ª—è Android
```
–ü–ª—é—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Armbian/Debian —Å–µ—Ä–≤–∏—Å—ã (systemd-journald, networkd, sshd –∏ —Ç.–¥.)

**31. –ï—Å—Ç—å –ª–∏ swap?**
–î–∞ ‚Äî zram: 512MB, –∞–ª–≥–æ—Ä–∏—Ç–º zstd, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 100.
–§–∏–∑–∏—á–µ—Å–∫–æ–≥–æ swap-—Ä–∞–∑–¥–µ–ª–∞ –Ω–µ—Ç (SD/eMMC –∏–∑–Ω–æ—Å).

---

## üéÆ –ë–õ–û–ö 7 ‚Äî Input

**32. –û—Ç–∫—É–¥–∞ input?**
- **–û—Å–Ω–æ–≤–Ω–æ–π**: Android companion app ‚Üí HTTP POST `/ui/key` ‚Üí mediashell polling
- **–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞**: pygame KEYDOWN (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ / –æ—Ç–ª–∞–¥–∫–∏)
- **USB –ø—É–ª—å—Ç / GPIO**: –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

**33. –ï—Å—Ç—å –ª–∏ –ª–∞–≥ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏?**
–î–∞. Polling-–º–æ–¥–µ–ª—å –¥–∞—ë—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π latency.

**34. –ö–∞–∫–æ–π —Å—Ä–µ–¥–Ω–∏–π latency –æ—Ç –Ω–∞–∂–∞—Ç–∏—è –¥–æ —Ä–µ–∞–∫—Ü–∏–∏?**
```
Android button press
    ‚Üí Retrofit HTTP POST /ui/key        ~5‚Äì20ms (WiFi hotspot)
    ‚Üí FastAPI –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å      ~1ms
    ‚Üí mediashell poll /ui/state         0‚Äì100ms (polling –∫–∞–∂–¥—ã–µ 100ms)
    ‚Üí handle_key() + redraw             ~33ms (1 –∫–∞–¥—Ä –ø—Ä–∏ 30 FPS)
```
–ò—Ç–æ–≥–æ: **~50‚Äì150ms** –≤ —Å—Ä–µ–¥–Ω–µ–º. –°—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ ‚Äî –∑–∞–º–µ—Ç–Ω–æ, –Ω–æ —Ç–µ—Ä–ø–∏–º–æ –¥–ª—è TV –ø—É–ª—å—Ç–∞.
–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –¥–æ <30ms –∏—Å–ø–æ–ª—å–∑—É—è WebSocket –≤–º–µ—Å—Ç–æ polling.

---

## üß© –ë–õ–û–ö 8 ‚Äî –°–µ—Ç–µ–≤–æ–π —Å–ª–æ–π

**35. REST API –Ω–∞ —á—ë–º?**
**FastAPI** + **uvicorn** (ASGI, –æ–¥–∏–Ω worker).
–ü–æ—Ä—Ç 8080, CORS `allow_origins=["*"]`.
–†–æ—É—Ç–µ—Ä—ã: `playback`, `ui`, `youtube`, `iptv`, `ota`, `system`.

**36. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ API –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ?**
–î–∞ ‚Äî uvicorn –∫—Ä—É—Ç–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º systemd-—Å–µ—Ä–≤–∏—Å–µ (`qaryxos-api.service`).
Mediashell –æ–±—â–∞–µ—Ç—Å—è —Å –Ω–∏–º –∫–∞–∫ HTTP-–∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ `httpx.Client`.

**37. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ UI —Å–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å?**
**–î–∞ ‚Äî —ç—Ç–æ —Ç–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞.** –≠–∫—Ä–∞–Ω—ã mediashell –¥–µ–ª–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ httpx-–≤—ã–∑–æ–≤—ã
–≤ –º–µ—Ç–æ–¥–∞—Ö `_load_groups()`, `_load_channels()`, `_load_feed()` ‚Äî –ø—Ä—è–º–æ –≤–æ –≤—Ä–µ–º—è
–æ—Ç—Ä–∏—Å–æ–≤–∫–∏. –ï—Å–ª–∏ API –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç (>100ms), pygame loop –∑–∞–º–∏—Ä–∞–µ—Ç:
```python
# iptv.py ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ on_enter() –∏ handle_key()
resp = self.shell.api.get("/iptv/groups")   # —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
```
–†–µ—à–µ–Ω–∏–µ ‚Äî –≤—ã–Ω–µ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å loading state.

---

## üß± –ë–õ–û–ö 9 ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

**38. –°–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏–º–µ—Ä–Ω–æ?**
~23 Python —Ñ–∞–π–ª–∞ + ~15 Kotlin —Ñ–∞–π–ª–æ–≤ + –∫–æ–Ω—Ñ–∏–≥–∏/—Å–µ—Ä–≤–∏—Å—ã.

**39. –ï—Å—Ç—å –ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–∞–ø–∫–∞–º?**
```
QaryxOS/
‚îú‚îÄ‚îÄ api/                     # FastAPI REST daemon
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ routers/             # playback, ui, youtube, iptv, ota, system
‚îÇ   ‚îî‚îÄ‚îÄ services/            # mpv, ytdlp, iptv, youtube, history, config
‚îú‚îÄ‚îÄ mediashell/              # pygame TV UI
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îî‚îÄ‚îÄ screens/             # home, youtube, iptv, url_input
‚îú‚îÄ‚îÄ os/                      # OS layer
‚îÇ   ‚îú‚îÄ‚îÄ overlay/             # systemd units, mpv.conf, avahi
‚îÇ   ‚îî‚îÄ‚îÄ scripts/             # install.sh, optimize-boot.sh
‚îú‚îÄ‚îÄ android/                 # Kotlin companion app
‚îÇ   ‚îî‚îÄ‚îÄ app/src/main/kotlin/
‚îÇ       ‚îú‚îÄ‚îÄ data/            # api/, models/
‚îÇ       ‚îú‚îÄ‚îÄ ui/screens/      # Remote, History, Channels, Firmware, Settings, Setup
‚îÇ       ‚îî‚îÄ‚îÄ discovery/       # NsdManager mDNS
‚îî‚îÄ‚îÄ ota/
    ‚îî‚îÄ‚îÄ updater.py           # CLI OTA tool
```

**40. –ï—Å—Ç—å –ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è?**
–î–∞, –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
| –§–∞–π–ª | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| `api/services/ytdlp.py` | `_URL_CACHE` | 4h –∫—ç—à stream URL |
| `api/routers/ota.py` | `_update_status` | –°—Ç–∞—Ç—É—Å OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| `api/routers/playback.py` | `_position_task` | asyncio.Task –ø–æ–∑–∏—Ü–∏–∏ |
| `mediashell/main.py` | `self.key_queue` | –û—á–µ—Ä–µ–¥—å –∫–ª–∞–≤–∏—à –æ—Ç Android |

---

## üî• –ë–õ–û–ö 10 ‚Äî –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**41. –ì–¥–µ —Å–µ–π—á–∞—Å —É–∑–∫–æ–µ –º–µ—Å—Ç–æ?**
1. **yt-dlp latency** ‚Äî –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ `--flat-playlist` –∑–∞–Ω–∏–º–∞–µ—Ç 15‚Äì45s
2. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ httpx –≤—ã–∑–æ–≤—ã –≤ mediashell** ‚Äî –±–ª–æ–∫–∏—Ä—É—é—Ç UI –Ω–∞ –≤—Ä–µ–º—è API-–∑–∞–ø—Ä–æ—Å–∞
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ thumbnail –∑–∞–≥—Ä—É–∑–∫–∏** ‚Äî –ø–ª–∏—Ç–∫–∏ YouTube –ø—É—Å—Ç—ã–µ (—Å–µ—Ä—ã–π placeholder)

**42. –ß—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ç–æ—Ä–º–æ–∑–∏—Ç?**
- yt-dlp –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∏–ª–∏ –ø–µ—Ä–≤–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ IPTV –∫–∞–Ω–∞–ª–æ–≤ (–±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Å –Ω—É–ª—è –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- `font.render()` –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –±–µ–∑ –∫—ç—à–∞ ‚Äî –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–ª–∏—Ç–æ–∫

**43. –ë—ã–≤–∞—é—Ç –ª–∏ —Ñ—Ä–∏–∑—ã?**
–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã –≤ –¥–≤—É—Ö —Å–ª—É—á–∞—è—Ö:
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π httpx –∑–∞–ø—Ä–æ—Å –≤ main loop –∑–∞–≤–∏—Å (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, timeout 5s)
- yt-dlp subprocess –∑–∞–Ω—è–ª >30s (–µ—Å—Ç—å timeout, –Ω–æ –¥–æ –Ω–µ–≥–æ UI –∑–∞–º–æ—Ä–æ–∂–µ–Ω)

**44. –ü–∞–¥–∞–µ—Ç –ª–∏ —á—Ç–æ-—Ç–æ?**
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç `Restart=always` –≤ systemd ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è.
–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ crash-—Ç–æ—á–∫–∏ (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏):
- ~~IndexError –≤ iptv.py –ø—Ä–∏ –ø—É—Å—Ç–æ–º —Å–ø–∏—Å–∫–µ –≥—Ä—É–ø–ø~~
- ~~Crash youtube.py –ø—Ä–∏ self.focused > len(videos)~~
- ~~MpvError –∏–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ `_ensure_connected()` –≤ system.py~~
- ~~–õ–∏–∫ asyncio.Task –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö /play –∑–∞–ø—Ä–æ—Å–∞—Ö~~

**45. –ß—Ç–æ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏?**
1. **–ù–µ—Ç overlay** ‚Äî –Ω–µ–ª—å–∑—è –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏–ª–∏ title –ø–æ–≤–µ—Ä—Ö mpv
2. **Polling –≤–º–µ—Å—Ç–æ WebSocket** ‚Äî –ª–∏—à–Ω–∏–µ 50‚Äì100ms latency –Ω–∞ –∫–∞–∂–¥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
3. **DRM –∫–æ–Ω—Ñ–ª–∏–∫—Ç** ‚Äî mpv –∏ mediashell –¥–µ–ª—è—Ç framebuffer –∏ –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–µ—Ç compositor/overlay plane)
4. **–ù–µ—Ç thumbnail** ‚Äî YouTube –ª–µ–Ω—Ç–∞ –≤—ã–≥–ª—è–¥–∏—Ç –ø—É—Å—Ç–æ–π –±–µ–∑ –æ–±–ª–æ–∂–µ–∫ –≤–∏–¥–µ–æ
5. **yt-dlp –Ω–∞ –ø–ª–∞—Ç–µ** ‚Äî –º–µ–¥–ª–µ–Ω–Ω—ã–π, —Ç—Ä–µ–±—É–µ—Ç Python runtime, ~50MB –ø–∞–º—è—Ç–∏
